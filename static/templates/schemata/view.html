
<gn-frame>

    <gn-permission project="project" role="admin" inverted="true">
        <h4>
            <span ng-show="schema.obj=='entity'">Entity schema:</span>
            <span ng-show="schema.obj=='relation'">Relation schema:</span>
            {{schema.label}} <small>{{schema.name}}</small>
        </h4>

        <div class="alert alert-info" ng-show="schema.obj=='entity' && schema.hidden">
            <strong>Hidden schema.</strong> This schema is not shown in listings, as it does 
            not describe a central characteristic of an entity, but auxilliary information.
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>Attribute</th>
                    <th>Field</th>
                    <th>Data type</th>
                    <th width="5%" class="boolean">Hidden</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="attribute in schema.attributes">
                    <td>{{attribute.label}}</td>
                    <td class="light">{{attribute.name}}</td>
                    <td>{{attribute.datatype}}</td>
                    <td class="boolean">
                        <i class="fa fa-check-square-o" ng-show="attribute.hidden"></i>
                        <i class="fa fa-square-o" ng-hide="attribute.hidden"></i>
                    </td>
                </tr>
            </tbody>
        </table>
    </gn-permission>

    <gn-permission project="project" role="admin">
        <form class="form-horizontal" role="form" name="editSchema">
          <div class="form-group" ng-class="{'has-error': editSchema.label.$invalid}">
            <label class="col-sm-2 control-label" for="label">Schema label</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="label" name="label" ng-model="schema.label" placeholder="Project label">
              <p class="help-block" ng-show="editSchema.label.$invalid" ng-bind="editSchema.label.$message"></p>
              <span class="help-block">Will be visible on entity pages.</span>
            </div>
          </div>

          <div class="form-group" ng-class="{'has-error': editSchema.name.$invalid}">
            <label class="col-sm-2 control-label" for="name">Identifier</label>
            <div class="col-sm-4">
              <input type="text" class="form-control" id="name" name="name" ng-model="schema.name" disabled placeholder="project-slug">
              <p class="help-block" ng-show="editSchema.name.$invalid" ng-bind="editSchema.name.$message"></p>
              <!--span class="help-block">Cannot be changed once the schema has been created.</span-->
            </div>

            <label class="col-sm-2 control-label" for="obj">Applies&nbsp;to</label>
            <div class="col-sm-2">
              <select class="form-control" id="obj" name="obj"
                ng-model="schema.obj" ng-options="key as value for (key, value) in config.SCHEMA_OBJS" disabled>
              </select>
              <p class="help-block" ng-show="editSchema.obj.$invalid" ng-bind="editSchema.obj.$message"></p>
              <!--span class="help-block">Schemata can apply either to entities or to relations.</span-->
            </div>
          </div>

          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <div class="checkbox">
                <label>
                  <input type="checkbox" ng-model="schema.hidden"> Hide this schema in listings.
                </label>
              </div>
            </div>
          </div>

          <table class="table">
            <thead>
                <tr>
                    <th>Attribute</th>
                    <th>Field</th>
                    <th>Data type</th>
                    <th width="5%" class="boolean">Hidden</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="attribute in schema.attributes">
                    <td>
                        <input type="text" class="form-control input-sm" id="name" name="name" ng-model="attribute.label">
                    </td>
                    <td class="light">{{attribute.name}}</td>
                    <td>{{attribute.datatype}}</td>
                    <td class="boolean">
                        <input type="checkbox" ng-model="attribute.hidden">
                    </td>
                </tr>
            </tbody>
          </table>


        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-primary" ng-click="update(editSchema)">Save</button>
            <button type="submit" class="btn btn-default" ng-click="reset()">Reset</button>
          </div>
        </div>
      </form>
    </gn-permission>

</gn-frame>
